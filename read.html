<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>MemeMaster</title>
</head>

<body>
    <h1>
        <a href="read.html">MemeMaster</a>
    </h1>

    <!-- When the My Account button is pressed, the user is redirected to the My Account page -->
    <button id="user_account">My Account</button>

    <!-- When the log out button is pressed, the user is logged out and redirected to the log in page -->
    <button id="logout">Log Out</button>

    <ul id="memeList"></ul>

    <!-- When the Add Meme button is pressed, the user is redirected to the meme editing page -->
    <button id="addMeme">Add Meme</button>

    <dialog id="confirm_delete">
        Are you sure you want to delete this meme?
        <content>
            <br />
            <button id="ok_delete">OK</button>
            <button id="cancel_delete">Cancel</button>
        </content>
    </dialog>
</body>
</html>

<!-- The script for Firebase -->
<script src="https://www.gstatic.com/firebasejs/5.6.0/firebase.js"></script>
<script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyCdi5c7M5eVOWShwCXOIjxQcweE_flzrZQ",
        authDomain: "cse-134b-final-project.firebaseapp.com",
        databaseURL: "https://cse-134b-final-project.firebaseio.com",
        projectId: "cse-134b-final-project",
        storageBucket: "cse-134b-final-project.appspot.com",
        messagingSenderId: "828897432315"
    };
    firebase.initializeApp(config);
</script>

<!-- Link the external JavaScript file -->
<script src="meme_master.js"></script>

<!-- JavaScript code for My Account button's onclick function -->
<script type="text/javascript">
    document.getElementById("user_account").onclick = function () {
        window.location = "account.html";
    }
</script>

<!-- JavaScript code for log out button's onclick function -->
<script type="text/javascript">
    document.getElementById("logout").onclick = function () {
        logout();
    }
</script>

<!-- JavaScript code for Create Meme button's onclick function -->
<script type="text/javascript">
    document.getElementById("addMeme").onclick = function () {
        sessionStorage.setItem("index", "-1");
        window.location = "createMeme.html";
    }
</script>

<!-- JavaScript code for Create Meme button's onclick function -->
<script type="text/javascript">
    document.getElementById("ok_delete").onclick = function () {
        var user = firebase.auth().currentUser;
        var ref = firebase.database().ref(user.uid);

        ref.once('value', deleteMeme, errData);
    }
</script>

<!-- JavaScript code for Create Meme button's onclick function -->
<script type="text/javascript">
    document.getElementById("cancel_delete").onclick = function () {
        document.getElementById("confirm_delete").open = false;
    }
</script>

<!-- JavaScript code for showing all of the user's saved memes -->
<script type="text/javascript">
    var userToken;
    firebase.auth().onAuthStateChanged(function (user) {
        if (user) {
            userToken = user.uid;
        }
        else {
            console.log("No user");
            window.location = "login.html";
        }
    });

    var ref = firebase.database().ref(userToken);
    ref.once('value', gotData, errData);
</script>
<script>
// Check that service workers are registered
if ('serviceWorker' in navigator) {
  // Use the window load event to keep the page load performant
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js');
  });
}
</script>