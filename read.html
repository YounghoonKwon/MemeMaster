<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>MemeMaster</title>
</head>

<body>
    <h1>
        <a href="index.html">MemeMaster</a>
    </h1>

    <button id="logout">Log Out</button>
    <ul id="memeList">
    </ul>

    <button id="createMeme">Create Meme</button>
</body>
</html>

<script src="https://www.gstatic.com/firebasejs/5.6.0/firebase.js"></script>
<script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyCdi5c7M5eVOWShwCXOIjxQcweE_flzrZQ",
        authDomain: "cse-134b-final-project.firebaseapp.com",
        databaseURL: "https://cse-134b-final-project.firebaseio.com",
        projectId: "cse-134b-final-project",
        storageBucket: "cse-134b-final-project.appspot.com",
        messagingSenderId: "828897432315"
    };
    firebase.initializeApp(config);
</script>

<script src="signup.js"></script>

<script type="text/javascript">
    document.getElementById("logout").onclick = function () {
        logout();
    }
</script>
<script type="text/javascript">
    document.getElementById("createMeme").onclick = function () {
        window.location = "createMeme.html"
    }
</script>
<script type="text/javascript">
    var database = firebase.database();
    var userToken;
    firebase.auth().onAuthStateChanged(function(user){
        if(user){
            userToken = user.uid;
        }
        else{
            console.log("no user");
        }
    });
    var ref = database.ref(userToken);
    ref.on('value', gotData, errData);
    function gotData(data){
        // var keys = Object.keys(memes[0]);
        for(var key1 in data.val()){
            for(var key2 in data.val()[key1]){
                var meme = {
                    topText: "",
                    bottomText: "",
                    fontSize: "",
                    fontFamily: "",
                    imgSrc:""
                };
                for(var item in data.val()[key1][key2]){
                    if(item == "bottomText"){
                        meme.bottomText = data.val()[key1][key2][item];
                    }
                    else if(item == "topText"){
                        meme.topText = data.val()[key1][key2][item];
                    }
                    else if(item == "fontSize"){
                        meme.fontSize = data.val()[key1][key2][item];
                    }
                    else if(item == "fontFamily"){
                        meme.fontFamily = data.val()[key1][key2][item];
                    }
                    else if(item == "imgSrc"){
                        meme.imgSrc = data.val()[key1][key2][item];
                    }
                }
                // var li = document.createElement("li");
                // li.innerHTML = `${meme.bottomText} ${meme.topText} ${meme.fontSize} ${meme.fontFamily} ${meme.imgSrc}`;
                // document.getElementById("memeList").appendChild(li);
                showMemeList(meme.bottomText, meme.topText, meme.fontSize, meme.fontFamily, meme.imgSrc);
            }
        }
    }
    function errData(err){
        console.log("Error!"+err);
    }
    function showMemeList(bottomText, topText, fontSize, fontFamily, image){
        var canvas = document.createElement("canvas");
        canvas.width = 300;
        canvas.height = 300;
        canvas.style = "border:1px solid";
        var br = document.createElement("br");
        canvas.id = "meme";
        var ctx = canvas.getContext("2d");
        var img = new Image();
        img.onload = function(){
            ctx.drawImage(img, 0, 0, 300, 300);
            var font = fontSize + "px " + fontFamily;
        ctx.font = font;
        ctx.fillStyle = "white";
        ctx.strokeStyle = "black";
        ctx.textAlign="center";
        ctx.strokeText(topText,150,50);
        ctx.strokeText(bottomText,150,270);
        }
        img.src = image;
        document.getElementById("memeList").appendChild(canvas);
        document.getElementById("memeList").appendChild(br);
    }
</script>