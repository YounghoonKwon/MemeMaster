<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>MemeMaster</title>
</head>

<body>
    <h1>
        <a href="index.html">MemeMaster</a>
    </h1>
    
    <canvas id="memeCanvas" width="300" height="300" style="border:1px solid"></canvas>
    <img id="img1" style="display: none" src="defaultimage.png" />
    <div id="memeText">
    	Top: <input type="text" id="topText"><br>
  		Bottom: <input type="text" id="bottomText"><br>
  		<button onclick="applyMeme()">apply</button>	
    </div>
    <br>
    <input type="file" id="imageLoader" name="imageLoader"/>
	<img id='output'>
    <button id="logout">Log Out</button>
</body>
</html>

<script src="https://www.gstatic.com/firebasejs/5.6.0/firebase.js"></script>
<script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyCdi5c7M5eVOWShwCXOIjxQcweE_flzrZQ",
        authDomain: "cse-134b-final-project.firebaseapp.com",
        databaseURL: "https://cse-134b-final-project.firebaseio.com",
        projectId: "cse-134b-final-project",
        storageBucket: "cse-134b-final-project.appspot.com",
        messagingSenderId: "828897432315"
    };
    firebase.initializeApp(config);
</script>
<script type="text/javascript">
    document.getElementById("logout").onclick = function () {
        logout();
    }
</script>
<script type="text/javascript">
	function showCanvas(topText="hello", bottomText="haha", img=document.getElementById("img1")) {
	    var canvas = document.getElementById("memeCanvas");
	    var ctx = canvas.getContext("2d");
	    ctx.drawImage(img, 0, 0, 300, 300);
	    ctx.font = "30px Arial";
		ctx.fillText(topText,0,50);
		ctx.fillText(bottomText,0,270);
	};
	showCanvas();
</script>
<script>
	var imageLoader = document.getElementById('imageLoader');
	    imageLoader.addEventListener('change', handleImage, false);
	var canvas = document.getElementById('memeCanvas');
	var ctx = canvas.getContext('2d');


	function handleImage(e){
	    var reader = new FileReader();
	    reader.onload = function(event){
	        var img = new Image();
	        img.onload = function(){
	            ctx.drawImage(img,0,0, 300, 300);
				var topText = document.getElementById("topText").value;
				var bottomText = document.getElementById("bottomText").value;
	            ctx.fillText(topText,0,50);
	            ctx.fillText(bottomText,0,270);
	        }
	        img.src = event.target.result;
	        document.getElementById("img1").src = img.src;
	    }
	    reader.readAsDataURL(e.target.files[0]);     
	}
	function applyMeme(){
		var topText = document.getElementById("topText").value;
		var bottomText = document.getElementById("bottomText").value;
		showCanvas(topText, bottomText, document.getElementById("img1"));
	};	
</script>